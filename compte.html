<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<title>Mon compte â€” PetBook</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<script src="https://cdn.auth0.com/js/auth0-spa-js/2.2/auth0-spa-js.production.js"></script>
<style>
    :root{--brand:#22c55e;--border:#e5e7eb}
    *{box-sizing:border-box} body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:#fff;color:#111}
    .wrap{min-height:100dvh;display:grid;place-items:center;padding:24px}
    .card{width:min(560px,92vw);border:1px solid var(--border);border-radius:14px;padding:22px 20px}
    .title{margin:0 0 6px;font-size:24px}
    .muted{margin:0 0 16px;color:#666}
    .btn{display:inline-flex;gap:8px;align-items:center;padding:10px 14px;border-radius:10px;border:1px solid var(--border);cursor:pointer}
    .btn.danger{border-color:#ef4444;color:#ef4444}
    .row{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .box{background:#fafafa;border:1px solid var(--border);border-radius:12px;padding:12px}
    .label{font-size:12px;color:#666;margin:0 0 6px}
    .val{margin:0}
    .status{margin-top:12px;font-size:14px;color:#444}
  </style>
</head>
<body>
<main class="wrap">
<section class="card">
<h1 class="title">Mon compte</h1>
<p class="muted" id="hello">Chargementâ€¦</p>
<div class="box">
<p class="label">E-mail</p>
<p class="val" id="email">â€”</p>
</div>
<div class="row" style="margin-top:16px">
<button class="btn danger" id="logout">Se dÃ©connecter</button>
<a class="btn" href="/">Retour Ã  lâ€™accueil</a>
</div>
<p class="status" id="status"></p>
</section>
</main>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const BASE = location.origin;
  const auth0 = await createAuth0Client({
    domain: "dev-y6a4ysjvjidhk636.us.auth0.com",
    client_id: "ItQnwH65emGqhsKau7BxDNSt1GASe08D",
    authorizationParams: { redirect_uri: `${BASE}/compte.html` },
    cacheLocation: "localstorage",
    useRefreshTokens: true
  });
  try {
    if (location.search.includes("code=") && location.search.includes("state=")) {
      await auth0.handleRedirectCallback();
      history.replaceState({}, document.title, "/compte.html");
    }
    const ok = await auth0.isAuthenticated();
    if (!ok) return location.replace(`${BASE}/login.html`);
    const user = await auth0.getUser();
    const he = document.getElementById("hello");
    const em = document.getElementById("email");
    if (he) he.textContent = `Bonjour ${user.name || user.email} ðŸ‘‹`;
    if (em) em.textContent = user.email || "â€”";
  } catch(e) { console.error(e); location.replace(`${BASE}/login.html`); }
  const lo = document.getElementById("logout");
  if (lo) lo.addEventListener("click", () => auth0.logout({ logoutParams: { returnTo: `${BASE}/login.html` } }));
});
</script></body>
</html>
